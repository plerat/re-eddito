{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}


    <section class="feed">

        <h1 class="feed-title">Derniers posts</h1>

        {% for post in posts %}
            <article class="post-card">

                <header class="post-header">
                    <h2 class="post-title">{{ post.title }}</h2>

                    <div class="post-meta">
                    <span>
                        par
                        <a href="{{ path('app_user_profile', {'id': post.createdBy.id}) }}">
                            {{ post.createdBy.pseudo }}
                        </a>
                    </span>
                        <span>{{ post.createdAt|date('d/m/Y H:i') }}</span>
                    </div>
                </header>

                <div class="post-body">
                    <p class="post-content">{{ post.content }}</p>

                    {% if post.medias|length > 0 %}
                        <div class="post-media">
                            {% for media in post.medias %}
                                {% if media.type in ['mp4','avi'] %}
                                    <video controls>
                                        <source src="{{ path('app_media_download', {'id': media.id}) }}">
                                    </video>
                                {% else %}
                                    <img src="{{ path('app_media_download', {'id': media.id}) }}" alt="">
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <footer class="post-footer">
                    <div class="post-actions">

                        <div class="post-actions-main">
                            <a class="post-link"
                               href="{{ path('app_post_show', {'id': post.id}) }}">
                                Voir
                            </a>

                            <a class="post-link"
                               href="{{ path('app_comment_new', {'id': post.id}) }}">
                                Répondre
                            </a>

                            {% if app.user and app.user.id == post.createdBy.id %}
                                <a class="post-link"
                                   href="{{ path('app_post_edit', {'id': post.id}) }}">
                                    Éditer
                                </a>
                            {% endif %}
                        </div>

                        {% if is_granted('ROLE_ADMIN') %}
                            <div class="post-actions-danger">
                                {{ include('post/_delete_form.html.twig', { post: post }) }}
                            </div>
                        {% endif %}

                    </div>
                </footer>


            </article>
        {% else %}
            <p class="empty-state">Aucun post pour le moment.</p>
        {% endfor %}
        {{ knp_pagination_render(posts) }}
    </section>
{% endblock %}
