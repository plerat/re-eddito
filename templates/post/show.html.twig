{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}

    <section class="feed">

        <a class="back-link" href="{{ path('app_home') }}">
            ← Retour aux posts
        </a>
        <article class="post-card">
            <header class="post-header">

                <h1 class="post-title">{{ post.title }}</h1>

                <div class="post-meta">
                <span>
                    par
                    <a href="{{ path('app_user_profile', {'id': post.createdBy.id}) }}">
                        {{ post.createdBy.pseudo }}
                    </a>
                </span>
                    <span>
                    {{ post.createdAt|date('d/m/Y H:i') }}
                </span>
                </div>
            </header>
            <div class="post-body">
                <p class="post-content">
                    {{ post.content }}
                </p>
                {% if post.medias is defined and post.medias|length > 0 %}
                    <div class="post-media">
                        {% for media in post.medias %}
                            {% if media.type in ['mp4','avi'] %}
                                <video controls>
                                    <source
                                        src="{{ path('app_media_download', {'id': media.id}) }}"
                                        type="video/{{ media.type }}"
                                    />
                                </video>
                            {% else %}
                                <img
                                    src="{{ path('app_media_download', {'id': media.id}) }}"
                                    alt="{{ media.name }}">
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <footer class="post-footer">
                <div class="post-actions">

                    <a class="post-link"
                       href="{{ path('app_comment_new', {'id': post.id}) }}">
                        Répondre
                    </a>
                    {% if app.user and app.user.id == post.createdBy.id %}
                        <a class="post-link"
                           href="{{ path('app_post_edit', {'id': post.id}) }}">
                            Éditer
                        </a>
                    {% endif %}
                    {% if is_granted('ROLE_ADMIN') %}
                        {{ include('post/_delete_form.html.twig') }}
                    {% endif %}
                </div>
            </footer>
        </article>

        <h2 class="feed-title">Commentaires</h2>
        {% for comment in comments %}
            {% if comment.parent is null %}
                <article class="post-card post-comment">
                    <div class="post-meta">
                        <a href="{{ path('app_user_profile', {'id': comment.createdBy.id}) }}">
                            {{ comment.createdBy.pseudo }}
                        </a>
                        <span>
                        {{ comment.createdAt|date('d/m/Y H:i') }}
                    </span>
                    </div>

                    <p class="post-content">
                        {{ comment.content }}
                    </p>

                    <div class="post-actions">
                        <a class="post-link"
                           href="{{ path('app_comment_show', {'id': comment.id}) }}">
                            Voir
                        </a>

                        <a class="post-link"
                           href="{{ path('app_comment_reply', {'id': comment.id}) }}">
                            Répondre
                        </a>

                        {% if app.user and app.user.id == comment.createdBy.id %}
                            <a class="post-link"
                               href="{{ path('app_comment_edit', {'id': comment.id}) }}">
                                Éditer
                            </a>
                        {% endif %}

                        {% if is_granted('ROLE_ADMIN') or (app.user and app.user.id == comment.createdBy.id) %}
                            {{ include('comment/_delete_form.html.twig', { comment: comment }) }}
                        {% endif %}
                    </div>
                </article>
            {% endif %}
        {% else %}
            <p class="empty-state">Aucun commentaire.</p>
        {% endfor %}

    </section>

{% endblock %}
