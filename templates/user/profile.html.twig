{% extends 'base.html.twig' %}

{% block title %}
    Profil de {{ user.pseudo }}
{% endblock %}

{% block body %}

    <a class="back-link" href="{{ path('app_home') }}">
        ← Retour
    </a>

    <section class="profile-card">
        <h1 class="profile-username">
            {{ user.pseudo }}
            {% if isOwner %}
                <small>(vous)</small>
            {% endif %}
        </h1>

        {% if isOwner %}
            <p class="profile-value">{{ user.email }}</p>
        {% endif %}
    </section>

    {% if isOwner %}
        <section class="profile-card">
            <h2 class="form-title">Changer mon pseudo</h2>

            {% if error %}
                <p class="form-error">{{ error }}</p>
            {% endif %}

            {{ form_start(form) }}
            {{ form_row(form.pseudo) }}
            {{ form_row(form._password) }}

            <button type="submit" class="btn-primary">
                Mettre à jour
            </button>
            {{ form_end(form) }}
        </section>
    {% endif %}

    <nav class="profile-tabs">
        <a href="#posts" class="profile-tab">Posts</a>
        <a href="#comments" class="profile-tab">Commentaires</a>
    </nav>

    <section id="posts" class="feed">
        <h2 class="feed-title">Posts</h2>

        {% for post in posts %}
            <article class="post-card">
                <h3 class="post-title">{{ post.title }}</h3>
                <p class="post-content">{{ post.content }}</p>

                <div class="post-meta">
                    <span>{{ post.createdAt|date('d/m/Y H:i') }}</span>

                    <div class="post-actions">
                        <a class="post-link" href="{{ path('app_post_show', {'id': post.id}) }}">Voir</a>

                        {% if isOwner %}
                            <a class="post-link" href="{{ path('app_post_edit', {'id': post.id}) }}">Éditer</a>
                        {% endif %}
                    </div>
                </div>
            </article>
        {% else %}
            <p class="empty-state">Aucun post.</p>
        {% endfor %}
    </section>

    <section id="comments" class="feed">
        <h2 class="feed-title">Commentaires</h2>

        {% for comment in comments %}
            <article class="post-card">
                <p class="post-content">{{ comment.content }}</p>

                <div class="post-meta">
                    <span>{{ comment.createdAt|date('d/m/Y H:i') }}</span>

                    <div class="post-actions">
                        <a class="post-link"
                           href="{{ path('app_comment_show', {'id': comment.id}) }}">
                            Voir
                        </a>

                        {% if isOwner %}
                            <a class="post-link"
                               href="{{ path('app_comment_edit', {'id': comment.id}) }}">
                                Éditer
                            </a>
                        {% endif %}

                        {% if  is_granted('ROLE_ADMIN') %}
                            {{ include('comment/_delete_form.html.twig', { comment: comment }) }}
                        {% endif %}
                    </div>

                </div>
            </article>
        {% else %}
            <p class="empty-state">Aucun commentaire.</p>
        {% endfor %}
    </section>

{% endblock %}
